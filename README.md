# Realme

Сервис 'enricher_sensor_information' принимает запросы клиентов, через брокер сообщений NATS и выполняет поиск информации о сенсоре в разных источниках. Возвращается следующий перечень информации:

- наименование организации (объекта) где усатновлен сенсор;
- полное наименование организации (объекта) где усатновлен сенсор;
- сфера деятельности организации (объекта)
- субъект Российской Федерации
- налоговый идентификатор организации (объекта)
- перечень домашних сетей

## Конфигурационные настройки

Конфигурационные параметры для этого сервиса, могут быть заданы как через конфигурационный файл, так и методом установки переменных окружения. Однако, все пароли и ключевые токены, используемые для авторизации, задаются ТОЛЬКО через переменные окружения.

#### Типы конфигурационных файлов:

- config.yml общий конфигурационный файл, здесь хранятся настройки логирования и параметры доступа к Zabbix;
- config_dev.yml конфигурационный файл используемый при развертывании тестовой инфраструктуры максимально приближенной к продуктовой;
- config_prod.yml конфигурационный файл применяемый в продуктовом режиме.

Основная переменная окружения для данного приложения - GO_ENRICHERSENSORINFO_MAIN. На основании значения этой переменной принимается решение какой из конфигурационных файлов config_dev.yml или config_prod.yml использовать. При GO_ENRICHERSENSORINFO_MAIN=development будет использоваться config_dev.yml, во всех остальных случаях, в том числе и при отсутствии переменной окружения GO_ENRICHERSENSORINFO_MAIN будет использоваться конфигурационный файл config_prod.yml. Перечень переменных окружения которые можно использовать для настройки приложения:

#### Переменная окружения отвечающая за тип запуска приложения "development" или "production"

- GO_ENRICHERSENSORINFO_MAIN

#### Переменные окружения отвечающие за подключение к NATS

- GO_ENRICHERSENSORINFO_NHOST - ip или доменное имя;
- GO_ENRICHERSENSORINFO_NPORT - сетевой порт;
- GO_ENRICHERSENSORINFO_NSUBSC - подписка для приёма запросов на выполнение поиска информации о геопозиционировани;
- GO_ENRICHERSENSORINFO_NCACHETTL - данный параметр должен содержать время жизни записи кэша, по истечение которого запись автоматически удаляется, значение задается в секундах в диапазоне от 10 до 86400 секунд;

#### Переменные окружения отвечающие за подключение к БД с информацией о сенсорах

- GO_ENRICHERSENSORINFO_SIHOST - ip или доменное имя;
- GO_ENRICHERSENSORINFO_SIPORT - сетевой порт;
- GO_ENRICHERSENSORINFO_SIUSER - имя пользователя
- GO_ENRICHERSENSORINFO_SIPASSWD - пароль пользователя
- GO_ENRICHERSENSORINFO_SIRTIMEOUT - время ожидания выполнения запроса
- GO_ENRICHERSENSORINFO_SINCIRCCURL - URL ресурса НКЦКИ
- GO_ENRICHERSENSORINFO_SINCIRCCTOKEN - токен для доступа к БД НКЦКИ (данные об организации по её ИНН)

#### Переменные окружения отвечающие за настройку доступа к БД применяемой для хранения логов

- GO_ENRICHERSENSORINFO_DBWLOGHOST - доменное имя или ip БД
- GO_ENRICHERSENSORINFO_DBWLOGPORT - порт БД
- GO_ENRICHERSENSORINFO_DBWLOGNAME - наименование БД (при необходимости)
- GO_ENRICHERSENSORINFO_DBWLOGUSER - пользователь БД
- GO_ENRICHERSENSORINFO_DBWLOGPASSWD - пароль для доступа к БД
- GO_ENRICHERSENSORINFO_DBWLOGSTORAGENAME - наименование объекта хранения логов (таблица, документ, индекс и т.д. зависит от типа БД)

Настройки логирования данных в БД не являются обязательными и необходимы только если пользователь приложения желает хранить логи в базе данных.

Приоритет значений заданных через переменные окружения выше чем значений полученных из конфигурационных файлов. Таким образом можно осуществлять гибкую временную настройку приложения.

#### Пример запроса для выполнения поиска данных

```json
{
  "source": "наименование источника запроса",
  "task_id": "id задачи",
  "list_sensors": ["перечень искомых сенсоров"]
}
```

#### Пример ответа на запрос

```json
{
  "source": "наименование источника запроса",
  "task_id": "id задачи",
  "found_information": [
    {
      "inn": "индивидуальный налоговый идентификатор",
      "geo_code": "географический код",
      "home_net": "перечень домашних сетей",
      "organization_name": "наименование организации",
      "sensor_id": "идентификатор сенсора",
      "object_area": "сфера деятельности объекта",
      "full_organization_name": "полное наименование организации",
      "special_sensor_id": "специальный идентификатор сенсора",
      "subject_russian_federation": "субъект Российской Федерации",
      "error": "ошибка возникшая при обаботке сенсора"
    }
  ]
}
```
